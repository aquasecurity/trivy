# Remote image scan test
# This test verifies that Trivy can scan remote images directly

# Test remote image scanning with fixed image digest
trivy image --image-src remote alpine:3.19@sha256:c5b1261d6d3e43071626931fc004f70149baeba2c8ec672bd4f27761f8e1ad6b

# Verify DB download message appears
stdout 'Downloading vulnerability DB...'

# Verify scan completed successfully
! stderr 'FATAL'
stdout 'Total: [0-9]+ packages'
stdout 'Vulnerabilities: [0-9]+'

# Verify cache directory was created
exists $WORK/.cache
exists $WORK/.tmp